<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/cart.css">
    <link rel="stylesheet" href="../lib/bootstrap/dist/css/bootstrap.min.css">
</head>
<body>
    <!--顶部导航栏 -->
    <div class="headerwrap">
        <div class="header">
            <span>欢迎来到聚美</span>
            <a href="./login.html">请登录</a>
            <a href="./zhuce.html">快速注册</a>
            <ul>
                <li> <a href=""> 正品保证</a></li>
                <li> <a href=""> 订单查询</a></li>
                <li> <a href=""> ❤收藏的品牌</a></li>
                <li class="myjm">
                    <a href=""> 我的聚美<span class="caret"></span></a>
                    <div class="myjumei">
                        <ul>
                            <li> <a href="">我的订单</a> </li>
                            <li> <a href="">我的现金券</a> </li>
                            <li> <a href="">我的红包</a> </li>
                            <li> <a href="">我的余额</a> </li>
                            <li> <a href="">我的提现退款</a> </li>
                            <li> <a href="">我的收藏</a> </li>
                            <li> <a href="">我的心愿单</a> </li>
                            <li> <a href="">会员中心</a> </li>
                            <li> <a href="">礼品卡兑换</a> </li>
                        </ul>
                    </div>
                </li>
                <li>|</li>
                <li class="phone">手机聚美</li>
                <li>|</li>
                <li> <a href=""> 更多<span class="caret"></span></a></li>
                
            </ul>
            
        </div>
    </div>
    <!--logo-->
    <div class="search">
        <div class="logo">
            <a href="./index.html">
                <img src="http://p0.jmstatic.com/templates/jumei/images/logo_new_v1.jpg" alt="">
            </a>
        </div>
        <div class="text">
            <div class="phone">400-123-8888</div>
            <div class="time">9:00-18:00</div>
        </div>
        <div class="order_path order_path_1">
        </div>
        
    </div>
    <!--导航栏 -->
    <div class="navwrap">
    </div>
    <!-- 购物车列表 -->
    <div class="content_show_wrap">
        
    </div>
    
    <!-- footer -->
    <div id="footer_container">
        <div class="footer_con" id="footer_copyright">
            <p class="footer_copy_con">
                Copyright © 2010-2015 北京创锐文化传媒有限公司 Jumei.com 保留一切权利。客服热线：400-123-8888 <br>
                京公网安备 11010102001226 号 | <a href="http://www.miibeian.gov.cn" target="_blank" rel="nofollow">京ICP证111033号</a> | 食品流通许可证 SP1101051110165515（1-1）
                <a href="http://mp5.jmstatic.com/mobile/pc/chuangrui.jpg" target="_blank" rel="nofollow">营业执照</a>
                <a href="http://f1.jmstatic.com/static_account/dist/v1.0.85067/images/other/zhidu.pdf" target="_blank" rel="nofollow">公示制度</a>
            </p>
            <p>
                <a href="javascript:void(0)" class="footer_copy_logo logo01" rel="nofollow"></a>
                <a href="http://www.itrust.org.cn/Home/Index/itrust_certifi/wm/1693268180.html" target="_blank" class="footer_copy_logo logo02" rel="nofollow"></a>
                <a href="javascript:void(0)" class="footer_copy_logo logo03" rel="nofollow"></a>
                <a href="javascript:void(0)" class="footer_copy_logo logo04" rel="nofollow"></a>
                <a href="https://ss.knet.cn/verifyseal.dll?sn=e1908021101057894518jv000000&amp;ct=df&amp;pa=nU60yFg7nXl37yQG" target="_blank" class="footer_copy_logo logo05" rel="nofollow"></a>
            </p>
        </div>
    </div>


    <script src="../lib/jquery/dist/jquery.min.js"></script>
    <script>
        // 1.获取数据
        const cartList = JSON.parse(localStorage.getItem('cartList'))
        // console.log(cartList);
        if(!cartList){
            alert('您的购物车为空，快去选购吧')
        }else{
            bindHtml()
            bindEvent()
        }
        function bindHtml(){

            let selectAll = cartList.every(item => {
                // 如果每一条都是 true, 就会返回 true
                // 如果任意一条是 false, 就会返回 false
                return item.isSelect === true
            })

            let str=`
            <div class="group_show">
                <div class="content_header clearfix">
                    <div class="content_header_left">
                        <i class="icon_small png"></i>
                        请在20分钟内结账，并在下单后20分钟内 完成支付
                    </div>
                    <div class="top_banner"> 
                        <ul class="header_icons"> 
                            <li> 
                                <span> 
                                    <i class="icon_zhenpin header_icon png"></i> 
                                    真品防伪码 
                                </span> 
                            </li> 
                            <li> 
                                <span> 
                                    <i class="icon_tuihuo header_icon png"></i> 
                                    7天无条件退货 
                                </span> 
                            </li> 
                            <li> 
                                <span> 
                                    <i class="icon_baoyou header_icon png"></i> 
                                    美妆满2件或299元包邮 
                                </span> 
                            </li> 
                        </ul> 
                    </div>
                </div>
                <table class="table">
                    <thead>
                        <tr> 
                            <th class="cart_overview"> 
                                <div class="cart_group_header"> 
                                    <input type="checkbox" class="js_group_selector cart_group_selector selectAll" ${ selectAll ? 'checked' : ''} }> 
                                    <h2>  全选  </h2> 
                                </div> 
                            </th> 
                            <th class="cart_price">聚美价（元）</th>  
                            <th class="cart_num">数量</th> 
                            <th class="cart_total">小计（元）</th> 
                            <th class="cart_option">操作</th> 

                        </tr>
                    </thead>
                    <tbody>`
            cartList.forEach(item =>{
                str+=`<tr>
                    <td class="tdone">
                        <ul>
                            <li class="tdone_ipt">
                                <input type="checkbox" data-id=${ item.id } class="selectOne" ${ item.isSelect ? 'checked' : '' } /">
                            </li>
                            <li class="tdone_img">
                                <img src="${ item.images }" alt="">
                            </li>
                            <li>
                                <p>${ item.name }</p>
                            </li>
                        </ul>
                            
                    </td>
                    <td class="tdd tb_price">${ item.price }</td>
                    <td class="tdd">
                        <div class="item_quantity_editer clearfix"> 
                            <span data-id=${ item.id } class="sub decrease_one disabled">-</span> 
                            <input class="item_quantity" type="text" value="${ item.number }"> 
                            <span data-id=${ item.id } class="add increase_one">+</span> 
                        </div>
                    </td>
                    <td class="tdd tb_xiaoji">${ item.xiaoji }</td>
                    <td class="tdd tb_delete">
                        <span data-id=${ item.id } class="delone"></span>
                    </td>
                </tr>`
            })            
            let selectArr = cartList.filter(item => item.isSelect)  
            // console.log(selectArr);
            // 选中商品数量计算
            let selectNumber = 0
            // 选中商品总价
            let selectPrice = 0
            selectArr.forEach(item => {
                selectNumber += item.number
                selectPrice += item.xiaoji
            })      
            str +=`
                </tbody>
                <tfoot class="tfoot">
                    <tr >
                        <td>
                            <a href="./index.html">继续购物</a>    
                            <span class="tf_sp1">|</span>
                            <span class="del clear">清空所有商品</span>
                        </td>

                        <td class="right_handler">
                            共<span class="total_amount"> ${ selectNumber } </span>件商品
                        </td>
                        <td colspan="2" class="right_zj">
                            商品应付总额：
                                <span class="total_price">¥${ selectPrice }</span> 
                        </td>
                        <td>
                            <a id="go_to_order" class="btn" href="javascript:;">
                                去结算
                            </a> 
                        </td>
                    </tr>
                </tfoot>
                
            </table>
        </div>
        `
            $('.content_show_wrap').html(str)
        }
        function bindEvent(){
            // 4-1. 全选按钮的事件
            $('.content_show_wrap').on( 'change','.selectAll' ,function(){
                // console.log(this.checked);
                cartList.forEach(item => {
                    item.isSelect = this.checked
                
                })
                bindHtml()
                localStorage.setItem('cartList', JSON.stringify(cartList))

            })

            // 4-2. 单选按钮的事件
            $('.content_show_wrap').on('change','.selectOne',function(){
                // console.log($(this).data('id'))
                const id = $(this).data('id')
                cartList.forEach(item =>{
                    if (item.id === id){
                        item.isSelect = !item.isSelect
                    }
                })
                bindHtml()
                localStorage.setItem('cartList',JSON.stringify(cartList))
            })

            // 4-3. 减少商品数量的事件
            $('.content_show_wrap').on('click','.sub',function(){
                // console.log(this);
                const id = $(this).data('id')

                cartList.forEach(item => {
                    if(item.id === id){
                        item.number > 1 ? item.number-- : ''
                        item.xiaoji = item.price * item.number
                    }
                })
                bindHtml()
                localStorage.setItem('cartList',JSON.stringify(cartList))
                
            })

            // 4-4. 增加商品数量的事件
            $('.content_show_wrap').on('click','.add',function(){
                // console.log(this);
                
                const id = $(this).data('id')

                cartList.forEach(item => {
                    if(item.id === id){
                        item.number++
                        item.xiaoji = item.price * item.number
                    }
                })
                bindHtml()
                localStorage.setItem('cartList',JSON.stringify(cartList))
            })

            // 4-5. 点击删除的事件
            $('.content_show_wrap').on('click', '.delone', function () {
                // 拿到自己身上的 id
                const id = $(this).data('id')
                // console.log(this);
                // Array.prototype.indexOf = function(val) {
                //     for (var i = 0; i < this.length; i++) {
                //         if (this[i] == val) return i;
                //     }
                //     return -1;
                // };
                // Array.prototype.remove = function(val) {
                //     var index = this.indexOf(val);
                //     if (index > -1) {
                //         this.splice(index, 1);
                //     }
                // };
                // var num = 
                cartList.forEach(item =>{
                    if(item.id === id){
                        var num = cartList.indexOf(item)
                        cartList.splice(num,1);                         
                    }                    
                })
                bindHtml()
                localStorage.setItem('cartList',JSON.stringify(cartList))
                
            })

            // 4-6. 点击清除的事件
            $('.content_show_wrap').on('click', '.clear', function () {
                // console.log(this);
                console.log(cartList);
                
                cartList.splice(0);                          
                bindHtml()
                localStorage.setItem('cartList',JSON.stringify(cartList))
                console.log('把数组清空')
                console.log('从新渲染页面')
                console.log('把空数组从新存储到 lcoalStorage 里面')
            })


        }
    </script>
</body>
</html>